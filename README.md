# アスベスト通報システム

## プロジェクト概要
- **名称**: アスベスト通報システム
- **目的**: 全国の市区町村のアスベスト関連問い合わせ先をAIで自動検索し、ユーザーに提供
- **主要機能**: 
  - 市区町村の簡単検索（インクリメンタルサーチ）
  - プルダウンによる都道府県・市区町村選択
  - Perplexity AIによる自動検索
  - 問い合わせ先情報の表示（電話、メール、フォーム、公式ページ）

## 公開URL
- **開発環境**: https://3000-isew77jy7wp9iattrfysr-5c13a017.sandbox.novita.ai

## 主要機能

### ✅ 実装済み機能
1. **市区町村検索**
   - インクリメンタルサーチ（入力すると候補を表示）
   - プルダウン選択（都道府県→市区町村）
   - 全国の市区町村データに対応

2. **問い合わせ先自動検索**
   - Perplexity AI（sonar-proモデル）による高精度検索
   - .go.jp、.lg.jpドメインに限定（公式サイトのみ）
   - 担当部署名、電話番号、メールアドレス、フォームURL、公式ページURLを自動抽出

3. **メールアドレス表示**
   - ✅ **常に表示**（見つからない場合は案内メッセージ）
   - 見つかった場合は「メールを送信」ボタンで即座にメールアプリ起動
   - 件名と本文を自動入力（市区町村、場所、詳細情報を含む）

4. **問い合わせフォーム表示**
   - ✅ **常に表示**（見つからない場合は案内メッセージ）
   - 見つかった場合は「フォームを開く」ボタンで新しいタブで開く
   - form、inquiry、contact、otoiawase、mail などのキーワードで検出

5. **その他の連絡先**
   - 電話番号（クリックで発信可能）
   - 公式ページへのリンク
   - AI検索結果の詳細表示

## データ構造
- **検索対象**: 全国47都道府県の市区町村データ
- **使用API**: Perplexity API（sonar-proモデル）
- **ストレージ**: 不要（APIベースの検索）

## 技術スタック
- **フレームワーク**: Hono + TypeScript
- **デプロイ**: Cloudflare Pages
- **フロントエンド**: TailwindCSS + Font Awesome
- **API**: Perplexity AI

## 開発環境

### セットアップ
```bash
npm install
npm run build
pm2 start ecosystem.config.cjs
```

### デプロイ
```bash
npm run deploy
```

### 環境変数
- `PERPLEXITY_API_KEY`: Perplexity APIキー（.dev.varsに設定済み）

## ユーザーガイド

### 使い方
1. **市区町村を選択**
   - 方法1: 検索ボックスに市区町村名を入力（例: 「本庄」「渋谷」）
   - 方法2: プルダウンから都道府県→市区町村を選択

2. **建物・場所の情報を入力**（任意）
   - 例: 「〇〇町1-2-3 △△ビル」

3. **詳細情報を入力**（任意）
   - 例: 「外壁の劣化が見られ、アスベストの可能性があります」

4. **「問い合わせ先を検索」ボタンをクリック**

5. **検索結果を確認**
   - 担当部署名
   - 電話番号（クリックで発信）
   - メールアドレス（クリックでメール送信）
   - 問い合わせフォーム（クリックでフォームを開く）
   - 公式ページ（クリックで公式サイトへ）

### メール送信機能
- 「メールを送信」ボタンをクリックすると、メールアプリが起動します
- 件名と本文は自動入力されます
- 入力した情報（市区町村、場所、詳細）が含まれます

### 問い合わせフォーム機能
- 「フォームを開く」ボタンをクリックすると、新しいタブで開きます
- 自治体の公式問い合わせフォームに直接アクセスできます

## デプロイ状況
- **プラットフォーム**: Cloudflare Pages（準備中）
- **ステータス**: ❌ 未デプロイ（開発環境のみ）
- **最終更新**: 2026-01-16

## 改善履歴

### 2026-01-16
- ✅ メールアドレスを常に表示（見つからない場合は案内メッセージ）
- ✅ 問い合わせフォームを常に表示（見つからない場合は案内メッセージ）
- ✅ メール送信ボタンに件名と本文の自動入力機能を追加
- ✅ フォーム検出パターンを拡張（mail、soudan、mail_form など）
- ✅ UI改善（ボタンスタイル、説明文追加）
- ✅ Perplexityプロンプトを改善（メールとフォームの検索精度向上）

## 今後の開発予定
- [ ] Cloudflare Pagesへの本番デプロイ
- [ ] 検索結果のキャッシュ機能
- [ ] FAX番号の表示
- [ ] 検索履歴機能
- [ ] お気に入り機能
